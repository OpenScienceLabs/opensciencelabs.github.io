{# theme/blog-list-base.html #}
{% set page_num = (pages|count / page_size)|round(method='ceil')|int %}

{% if page_num == 0 or not paging %}
  {% set page_num = 1 %}
  {% if not paging %}
    {% set page_size = (10000 if page_size == -1 else page_size) %}
  {% endif %}
{% endif %}

{# Define tag helpers if not provided #}
{% if render_tags is not defined %}
  {% from "blog-tags-render.html" import render_tags %}
{% endif %}
{% if get_tags_style is not defined %}
  {% from "blog-tags-render.html" import get_tags_style %}
{% endif %}

{% block tags_style %}
  {% call get_tags_style() %}{% endcall %}
{% endblock %}

<section class="blog-index">
  <h1 class="blog-title">Blog</h1>

  <div class="pages">
    {% for page_idx in range(0, page_num) %}
      {% set pg_group = pages[page_idx*page_size:(page_idx + 1)*page_size] %}
      <div class="page" id="page{{ page_idx + 1 }}">
        <ul class="post-grid" id="post-grid">
          {% for pg in pg_group %}
            {# collect fields #}
            {% set url = pg.canonical_url %}
            {% set title = pg.meta.title_full if pg.meta and pg.meta.title_full else pg.title %}
            {% set description = "" %}
            {% if full_content %}
              {% set description = pg.content|safe %}
            {% elif pg.meta.description %}
              {% set description = pg.meta.description|truncate %}
            {% endif %}
            {% set time = (pg.meta["localized-time"] if pg.meta and pg.meta["localized-time"] else "") %}

            {# delegate rendering of each LI to the macro #}
            {% call render_blog(title, description, time, url, pg) %}{% endcall %}
          {% endfor %}
        </ul>
      </div>
    {% endfor %}
  </div>

  <div class="blog-pager {{ 'blog-hidden' if page_num == 1 else '' }}">
    <nav class="blog-pagination" id="blog-pagination" aria-label="Pagination">
      {% for num in range(page_num) %}
        {% set link = '' if num == 0 else '#blog-p' ~ (num + 1)|string %}
        <a class="page-number" href="{{ link }}">{{ num + 1 }}</a>
      {% endfor %}
    </nav>
    {% if show_total %}
      <div class="blog-total">Total <b>{{ pages|count }}</b> posts.</div>
    {% endif %}
  </div>
</section>
